# SVG

将 svg 字符串转换成 le5le meta2d.js 可识别的 combine 组合画笔。  
本质上是将svg图片转化为由各个 [基本图形](./pens.html#%E5%9F%BA%E7%A1%80%E5%9B%BE%E5%BD%A2) 构成的组合节点，所以可以对各个子节点进行样式配置。

![乐吾乐meta2d svg](/img/svgToCombine.gif)

在线体验： http://t.le5le.com/

官方例子： https://github.com/le5le-com/meta2d.js/tree/master/examples/vue  
示例：

```shell
npm i @meta2d/svg
```

```js
import { parseSvg } from "@meta2d/svg";
import { deepClone } from '@meta2d/core';
// 若是文件，可通过 ajax 请求得到字符串
const svgStr = '<svg id="图层_2" data-name="图层 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128"><defs><style>.cls-1{fill:none;stroke:#fd211c;stroke-linejoin:round;}.cls-2{opacity:0.16;}</style></defs><title>g</title><g id="运行水电厂"><polyline class="cls-1" points="21.54 128 21.54 0 106.79 31.88 21.21 64.01"/><g class="cls-2"><path d="M45.78,68.79c-.17.37-.39.79-.65,1.25s-.54.95-.84,1.44-.6,1-.9,1.43-.59.88-.85,1.25L40.2,73c.27-.37.56-.77.87-1.22s.61-.9.89-1.36.55-.91.79-1.36.44-.83.59-1.18Zm4-1.85v4.12a4.1,4.1,0,0,1-.13,1.17,1.74,1.74,0,0,1-.45.73,2.42,2.42,0,0,1-.81.46c-.33.11-.73.23-1.21.34L46,74.05l-.83-2.59.9-.22a2.73,2.73,0,0,0,.72-.27.65.65,0,0,0,.2-.55V67.31l-5.59.74L42,60.31c.62-.08,1.28-.18,2-.29s1.4-.22,2.11-.34l2.14-.39c.71-.13,1.4-.27,2.06-.41s1.29-.27,1.87-.41,1.11-.26,1.57-.39l.55,2.63-2.08.48c-.76.17-1.57.34-2.41.5l-2.6.49-2.58.45-.17,2.55L47,64.84V62.63l2.78-.31v2.15l4.93-.65v2.47Zm2.72-.22c.17.19.39.45.65.78s.54.69.83,1.08.58.79.86,1.2.54.81.77,1.18l-2.36,1.82c-.18-.35-.4-.74-.65-1.15s-.51-.83-.79-1.24L51,69.25c-.27-.36-.51-.66-.73-.91Z"/><path d="M71.3,61.9v2.21L56.66,66V63.82l3.27-.43.25-1-2.39.31V60.84l2.84-.37.21-.87-3.4.44V57.85l13.08-1.73v2.2l-6.85.9-.21.88,6-.79-.15,2.85ZM58.11,66.56,69.86,65v5.63L58.11,72.19Zm2.59,3.09,6.44-.84V67.52l-6.44.85ZM62.78,63l3.87-.51.07-.95L63,62.05Z"/><path d="M78,64.55c-.17.37-.39.79-.65,1.25s-.54,1-.84,1.44-.6,1-.9,1.43-.59.88-.85,1.25l-2.34-1.13c.27-.36.56-.76.87-1.21s.61-.9.9-1.36.55-.91.79-1.36.43-.83.58-1.18Zm4-1.85v4.12A4.05,4.05,0,0,1,81.84,68a1.56,1.56,0,0,1-.45.73,2.12,2.12,0,0,1-.8.45c-.33.12-.74.23-1.22.35l-1.17.29-.83-2.6.9-.21a2.17,2.17,0,0,0,.72-.28.6.6,0,0,0,.21-.54V63.07l-5.6.74.58-7.74c.62-.08,1.28-.18,2-.29s1.4-.22,2.11-.34l2.14-.39c.72-.13,1.4-.27,2.07-.41s1.28-.27,1.87-.41,1.1-.26,1.56-.39l.55,2.63L84.38,57c-.77.17-1.57.34-2.42.5s-1.71.33-2.59.49l-2.58.45-.18,2.55,2.59-.34V58.38l2.78-.3v2.15l4.93-.65v2.47Zm2.71-.22q.27.29.66.78l.83,1.08c.29.39.58.79.86,1.2s.53.81.76,1.18l-2.36,1.82c-.18-.35-.4-.74-.65-1.16s-.51-.82-.79-1.23-.54-.78-.81-1.14-.51-.66-.72-.91Z"/></g></g></svg>';
// 得到一个组合后的 combine 画笔们，但父节点未拥有 x, y 
const pens = parseSvg(svgStr);
// 可使用 dragStart or meta2d.canvas.addCaches
meta2d.canvas.addCaches = deepClone(pens);
// 随后点击画布
```

## 尚未完善的点  

1. svg dom 功能强大具备 css3 动画，复杂渐变，甚至可以使用 js 来做一些逻辑处理，而 meta2d.js 是基于 canvas 的，目前尚不能解析出这些复杂的内容，目前 AI 所生成的简单 svg 图片均可以识别。
2. svg dom 存在 css 优先级，而 css 优先级权重逻辑过于复杂，而且频繁的判断逻辑会影响转换性能，所以在取 css 时，使用的是比较简单的合并操作。
3. text 标签中存在 tspan，嵌套层级可能较深，目前处理并不完善，只能处理比较简单的 text 标签，更推荐使用 AI 等工具将 text 转换成 path 路径标签。
4. use 复用标签，尚不支持。
5. path 标签计算位置可能存在差异，导致 path 标签转换的图形不便单独选中。
6. svg g 标签是一个组合标签，它可以不设置宽度高度，而内填充宽高，即内部图形多大，它多大；而 meta2d.js 的 combine 的宽高是必须要有的，需要递归处理宽高，目前未做，如有特殊场景，可联系官方。
7. 相较于浏览器所能识别的 svg 图片，差距还是较大，有问题欢迎完善。